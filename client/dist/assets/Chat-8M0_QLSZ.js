import{D as f,j as e,a1 as P,a2 as B,P as a,a3 as He,O as ue,r as t,a4 as qe,a5 as Oe,a6 as De,a7 as D,a8 as R,a9 as pe,Y as F,aa as re,ab as $e,ac as Pe,B as H,Q as ae,T as q,ad as Be,I as V,ae as Ne,u as We,af as Ue,ag as Ye,ah as Ge,ai as Qe,aj as Je,ak as Xe,al as Ke,S as ne,g as Ze,am as es,an as ss,ao as ts,X as rs,ap as as,aq as N,ar as oe,as as ie}from"./index-nQwRLWIV.js";import{A as ns}from"./AppLayout-FQM9ZGQQ.js";import{L as $}from"./ListItemText-D4lQFR75.js";import{R as os}from"./RenderAttachment-DlHa5bJt.js";import{m as is}from"./proxy-xsMdLfhG.js";import{A as cs}from"./Avatar-Cp_pS6TR.js";import{B as ce}from"./Button-CDrbuMrr.js";import{u as ls,a as ds}from"./hook-CbcOqQDK.js";import{F as ms}from"./index-CuMLlqtw.js";import{V as us}from"./Visibility--HCIm9HT.js";import"./Delete-DGRb6gYX.js";import"./Header-CqC6JSBY.js";import"./AvatarCard-Bh1tFwNb.js";import"./Drawer-CrhtyCwH.js";const ps=f(e.jsx("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"}),"AttachFile"),gs=f(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 11h-3v3.75c0 1.24-1.01 2.25-2.25 2.25S8.5 17.99 8.5 16.75s1.01-2.25 2.25-2.25c.46 0 .89.14 1.25.38V11h4zm-3-4V3.5L18.5 9z"}),"AudioFile"),hs=f(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12m8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8"}),"Block"),fs=f(e.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"Image"),le=f(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),xs=f(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile"),js=f(e.jsx("path",{d:"M14 2H6.01c-1.1 0-2 .89-2 2L4 20c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8zm-1 7V3.5L18.5 9zm1 5 2-1.06v4.12L14 16v1c0 .55-.45 1-1 1H9c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h4c.55 0 1 .45 1 1z"}),"VideoFile"),vs=f(e.jsx("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff"),ys=f(e.jsx("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning");var W={},bs=B;Object.defineProperty(W,"__esModule",{value:!0});var ge=W.default=void 0,Ss=bs(P()),Rs=e;ge=W.default=(0,Ss.default)((0,Rs.jsx)("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m2 14H7v-2h7zm3-4H7v-2h10zm0-4H7V7h10z"}),"Assignment");const he=({anchorEl:r,chatId:o})=>{const{isFileMenu:m}=He(s=>s.misc),x=ue(),C=t.useRef(null),j=t.useRef(null),k=t.useRef(null),c=t.useRef(null),[u]=qe(),p=()=>x(pe(!1)),A=()=>{var s;return(s=C.current)==null?void 0:s.click()},I=()=>{var s;return(s=j.current)==null?void 0:s.click()},w=()=>{var s;return(s=k.current)==null?void 0:s.click()},_=()=>{var s;return(s=c.current)==null?void 0:s.click()},g=async(s,v)=>{const y=Array.from(s.target.files);if(y.length<=0)return;if(y.length>5)return F.error(`You can only send 5 ${v} at a time`);x(re(!0));const M=F.loading(`Sending ${v}...`);p();try{const l=new FormData;l.append("chatId",o),y.forEach(h=>l.append("files",h)),(await u(l)).data?F.success(`${v} sent successfully`,{id:M}):F.error(`Failed to send ${v}`,{id:M})}catch(l){F.error(l.message,{id:M})}finally{x(re(!1))}};return e.jsx(Oe,{anchorEl:r,open:m,onClose:p,sx:{marginLeft:"324px",marginTop:"-45px"},children:e.jsx("div",{style:{width:"10rem"},children:e.jsxs(De,{children:[e.jsxs(D,{onClick:A,children:[e.jsx(R,{title:"Image",children:e.jsx(fs,{})}),e.jsx($,{style:{marginLeft:"0.5rem"},children:"Image"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/png, image/jpeg, image/gif",style:{display:"none"},onChange:s=>g(s,"Images"),ref:C})]}),e.jsxs(D,{onClick:I,children:[e.jsx(R,{title:"Audio",children:e.jsx(gs,{})}),e.jsx($,{style:{marginLeft:"0.5rem"},children:"Audio"}),e.jsx("input",{type:"file",multiple:!0,accept:"audio/mpeg, audio/wav",style:{display:"none"},onChange:s=>g(s,"Audios"),ref:j})]}),e.jsxs(D,{onClick:w,children:[e.jsx(R,{title:"Video",children:e.jsx(js,{})}),e.jsx($,{style:{marginLeft:"0.5rem"},children:"Video"}),e.jsx("input",{type:"file",multiple:!0,accept:"video/mp4, video/webm, video/ogg",style:{display:"none"},onChange:s=>g(s,"Videos"),ref:k})]}),e.jsxs(D,{onClick:_,children:[e.jsx(R,{title:"File",children:e.jsx(xs,{})}),e.jsx($,{style:{marginLeft:"0.5rem"},children:"File"}),e.jsx("input",{type:"file",multiple:!0,accept:"*",style:{display:"none"},onChange:s=>g(s,"Files"),ref:c})]})]})})})};he.propTypes={anchorEl:a.object.isRequired,chatId:a.string.isRequired};var U={},Cs=B;Object.defineProperty(U,"__esModule",{value:!0});var fe=U.default=void 0,ks=Cs(P()),de=e;fe=U.default=(0,ks.default)([(0,de.jsx)("path",{d:"M3 12v2h8.77l-1.11 5.34L15 15V5H6z",opacity:".3"},"0"),(0,de.jsx)("path",{d:"M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.58-6.59c.37-.36.59-.86.59-1.41V5c0-1.1-.9-2-2-2m0 12-4.34 4.34L11.77 14H3v-2l3-7h9zm4-12h4v12h-4z"},"1")],"ThumbDownAltTwoTone");var Y={},ws=B;Object.defineProperty(Y,"__esModule",{value:!0});var xe=Y.default=void 0,Ms=ws(P()),me=e;xe=Y.default=(0,Ms.default)([(0,me.jsx)("path",{d:"M12 4c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8m-2 13-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9z",opacity:".3"},"0"),(0,me.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m4.59-12.42L10 14.17l-2.59-2.58L6 13l4 4 8-8z"},"1")],"CheckCircleTwoTone");var G={},Ts=B;Object.defineProperty(G,"__esModule",{value:!0});var je=G.default=void 0,Ls=Ts(P()),As=e;je=G.default=(0,Ls.default)((0,As.jsx)("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"}),"DoneAllTwoTone");const ve=({message:r,user:o,chatName:m})=>{var l,T;console.log(" -----------------------------------"),console.log("MessageComponent  message:",r),console.log(" -----------------------------------");const x=$e(),C=new URLSearchParams(x.search),j=C.get("param"),k=C.get("secondParam"),{sender:c,content:u,attachments:p=[],createdAt:A,chat:I}=r,w=(c==null?void 0:c._id)===(o==null?void 0:o._id),_=Pe(A).fromNow(),g=(l=o.avatar)==null?void 0:l.url,s=(T=o.name[0])==null?void 0:T.toUpperCase(),v=!1,y=h=>{console.log("Approved",h)},M=h=>{console.log("Rejected",h)};return e.jsxs(is.div,{initial:{opacity:0,x:"-100%"},animate:{opacity:1,x:0},transition:{duration:.5},style:{alignSelf:w?"flex-end":"flex-start",backgroundColor:"white",color:"black",borderRadius:"5px",padding:"0.5rem",width:"fit-content",display:"flex",flexDirection:"column",alignItems:"flex-start",marginBottom:"1rem"},children:[!w&&e.jsxs(H,{display:"flex",alignItems:"center",marginBottom:"0.5rem",children:[e.jsx(cs,{alt:c.name,sx:{bgcolor:g?"transparent":ae,width:32,height:32,border:"2px solid #ccc",marginRight:"0.5rem",fontSize:"0.5rem"},children:!g&&s}),e.jsx(q,{color:ae,fontWeight:"600",variant:"body2",children:c.name})]}),e.jsxs(H,{children:[u&&e.jsx(q,{variant:"body1",style:{marginBottom:"0.1rem"},children:u}),p.length>0&&p.map((h,E)=>{const b=h.url,L=Be(b);return e.jsxs(H,{children:[e.jsx("a",{href:b,target:"_blank",download:!0,style:{color:"black"},onClick:i=>i.preventDefault(),children:os(L,b,k,v,o.age)}),(L==="image"||L==="video")&&o.age>=18&&j==="Request"&&e.jsxs(H,{display:"flex",flexDirection:"column",marginTop:"0.5rem",sx:{width:"100%",marginLeft:"1rem"},children:[e.jsxs(ce,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",border:"1px solid green",borderRadius:"1rem",padding:"0.5rem",maxWidth:"9.5rem",maxHeight:"1.5rem",marginBottom:"0.5rem"},children:[e.jsx(q,{variant:"body2",sx:{color:"#55cc00",fontSize:"0.8rem"},children:"Approve"}),e.jsx(V,{color:"success",onClick:()=>y("Approve"),children:e.jsx(xe,{fontSize:"small",sx:{color:"#55cc00"}})})]}),e.jsxs(ce,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",border:"1px solid red",borderRadius:"1rem",maxWidth:"9.5rem",maxHeight:"1.5rem",padding:"0.5rem"},children:[e.jsx(q,{variant:"body2",sx:{color:"red",fontSize:"0.8rem"},children:"Reject"}),e.jsx(V,{color:"error",onClick:()=>M("Reject"),children:e.jsx(fe,{fontSize:"small",sx:{color:"red"}})})]})]})]},E)}),e.jsxs(H,{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"0.1rem",children:[e.jsx(q,{variant:"caption",color:"text.secondary",children:_}),e.jsx(je,{fontSize:"small",sx:{color:"gray"}})]})]})]})};ve.propTypes={message:a.shape({sender:a.shape({_id:a.string.isRequired,name:a.string.isRequired,avatar:a.shape({url:a.string})}).isRequired,content:a.string,attachments:a.arrayOf(a.shape({url:a.string.isRequired})),createdAt:a.string.isRequired}).isRequired,user:a.shape({_id:a.string.isRequired,avatar:a.shape({url:a.string}),age:a.number,name:a.string}).isRequired};const Is=t.memo(ve),ye=({chatId:r,user:o})=>{var J,X,K,Z,ee,se;const m=Ne(),x=ue(),C=We(),{mode:j}=Ue(),k=t.useRef(null),c=t.useRef(null),[u,p]=t.useState(""),[A,I]=t.useState([]),[w,_]=t.useState(1),[g,s]=t.useState(null),[v,y]=t.useState(!1),[M,l]=t.useState(!1),T=t.useRef(null),[h,E]=t.useState(null),[b,L]=t.useState(!1),i=Ye({chatId:r,skip:!r}),O=Ge({chatId:r,page:w}),[S,Q]=t.useState(()=>sessionStorage.getItem("IsScannerOn")==="true");t.useEffect(()=>{sessionStorage.setItem("IsScannerOn",S)},[S]);const{data:be,setData:Se}=ms(k,(J=O.data)==null?void 0:J.totalPages,w,_,(X=O.data)==null?void 0:X.messages),Re=[{isError:i.isError,error:i.error},{isError:O.isError,error:O.error}],z=(Z=(K=i==null?void 0:i.data)==null?void 0:K.chat)==null?void 0:Z.members,Ce=(se=(ee=i==null?void 0:i.data)==null?void 0:ee.chat)==null?void 0:se.name,ke=n=>{x(pe(!0)),s(n.currentTarget)};t.useEffect(()=>(m.emit(Qe,{userId:o._id,members:z}),x(Je(r)),()=>{I([]),p(""),Se([]),_(1),m.emit(Xe,{userId:o._id,members:z})}),[r]),t.useEffect(()=>{c.current&&c.current.scrollIntoView({behavior:"smooth"})},[A]),t.useEffect(()=>{if(i.isError)return C("/")},[i.isError]);const we=t.useCallback(n=>{n.chatId===r&&I(d=>[...d,n.message])},[r]),Me=t.useCallback(n=>{n.chatId===r&&l(!0)},[r]),Te=t.useCallback(n=>{n.chatId===r&&l(!1)},[r]),Le=t.useCallback(n=>{if(n.chatId!==r)return;const d={content:n.message,sender:{_id:"djasdhajksdhasdsadasdas",name:"Admin"},chat:r,createdAt:new Date().toISOString()};I(te=>[...te,d])},[r]),Ae={[as]:Le,[N]:we,[oe]:Me,[ie]:Te},Ie=async n=>{try{return(await(await fetch("http://localhost:3000/api/v1/message/predict",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:n})})).json()).prediction===1?"Your message contains inappropriate content. That could be negative if there are children in this chat.":null}catch(d){return console.error("Error checking message:",d),"Error checking message."}},_e=()=>{E(null),L(!1),m.emit(N,{chatId:r,members:z,message:u}),p("")},ze=()=>{E(null),L(!1)},Ve=async n=>{if(n.preventDefault(),!u.trim())return;const d=await Ie(u);d&&S?(E(d),L(!0)):(m.emit(N,{chatId:r,members:z,message:u}),p(""))},Ee=n=>{const d=n.target.value;p(d),v||(m.emit(oe,{members:z,chatId:r}),y(!0)),T.current&&clearTimeout(T.current),T.current=setTimeout(()=>{m.emit(ie,{members:z,chatId:r}),y(!1)},2e3)};ls(m,Ae),ds(Re);const Fe=[...be,...A];return i.isLoading?e.jsx(Ke,{}):e.jsxs(t.Fragment,{sx:{bgcolor:j==="dark"?"red":"#e0e0e0"},children:[e.jsxs(ne,{ref:k,boxSizing:"border-box",padding:"1rem",spacing:"1rem",bgcolor:Ze,height:"90%",sx:{bgcolor:j==="dark"?"#fff":"#eceff1",overflowX:"hidden",overflowY:"auto","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"#f5f5f5"},"&::-webkit-scrollbar-thumb":{background:"#888",borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{background:"#555"},transition:"scrollbar-width 0.3s ease"},children:[Fe.map(n=>e.jsx(Is,{message:n,user:o,chatName:Ce},n._id)),M&&e.jsx(es,{}),b&&S&&e.jsxs("div",{style:{position:"absolute",bottom:"10%",left:"1rem",backgroundColor:"rgba(255,0,0,0.8)",color:"white",padding:"0.5rem",borderRadius:"0.3rem",display:"flex",justifyContent:"space-between",alignItems:"center",zIndex:1e3,margin:"0 0 18rem 28rem",width:"calc(35% - 1rem)",height:"calc(15% - 1rem)"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(ys,{style:{color:"yellow"}}),h]}),e.jsxs("div",{children:[e.jsx(R,{title:"Send",children:e.jsx(V,{onClick:_e,style:{color:"white"},children:e.jsx(le,{})})}),e.jsx(R,{title:"Block",children:e.jsx(V,{onClick:ze,style:{color:"white"},children:e.jsx(hs,{})})})]})]}),e.jsx("div",{ref:c})]}),e.jsx("form",{style:{height:"10%",position:"relative",pointerEvents:b&&S?"none":"auto",opacity:b&&S?.5:1},onSubmit:Ve,children:e.jsxs(ne,{direction:"row",height:"100%",padding:"1rem",alignItems:"center",position:"relative",borderRadius:.7,boxShadow:"0 0 5px 0 rgba(1, 1, 1, 0.1)",sx:{bgcolor:j==="dark"?"#2c2c2c":"#e0e0e0"},children:[e.jsx(ge,{sx:{position:"absolute",left:"1.9rem",bgcolor:ss[300],borderRadius:1},onClick:ke,children:e.jsx(R,{title:"Attach file",children:e.jsx(ps,{})})}),e.jsx(ts,{placeholder:"Type a message",value:u,sx:{height:"3rem",width:"100%",borderRadius:1},onChange:Ee,disabled:b&&S}),e.jsx(V,{sx:{position:"fixed",right:"29rem"},children:e.jsx(R,{title:"Scan Content",children:S?e.jsx(us,{onClick:()=>Q(!1)}):e.jsx(vs,{onClick:()=>Q(!0)})})}),e.jsx(V,{type:"submit",sx:{bgcolor:rs,color:"white",marginLeft:"1rem",padding:"0.5rem","&:hover":{bgcolor:"error.dark"}},children:e.jsx(le,{})})]})}),e.jsx(he,{anchorE1:g,chatId:r})]})};ye.propTypes={chatId:a.string.isRequired,user:a.shape({_id:a.string.isRequired}).isRequired};const Us=ns(ye);export{Us as default};
