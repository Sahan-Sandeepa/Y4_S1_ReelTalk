import{a1 as H,a2 as z,j as e,P as E,r as o,a3 as G,S as i,I as W,Y as l,Z as Y,$ as O,O as V,bT as $,bU as Q,T as X,al as Z,bV as J,aX as K}from"./index-nQwRLWIV.js";import{z as ee}from"./index-CuMLlqtw.js";import{U as re}from"./UserItem-sFQcFq5l.js";import{b as te,a as ae}from"./hook-CbcOqQDK.js";import{D as F}from"./dialogTitleClasses-CCwdIm8o.js";import{D as L}from"./DialogTitle-CJCGWghD.js";import{A as se}from"./Avatar-Cp_pS6TR.js";import{C as oe}from"./CameraAlt-B5Xul0kp.js";import{T as m}from"./TextField-DRpVSgRA.js";import{B as S}from"./Button-CDrbuMrr.js";import"./ListItem-DoZKma3k.js";import"./Add-C1FZUdzj.js";import"./Select-CNHqHSZW.js";var P={},ne=z;Object.defineProperty(P,"__esModule",{value:!0});var N=P.default=void 0,ie=ne(H()),le=e;N=P.default=(0,ie.default)((0,le.jsx)("path",{d:"M12 12.75c1.63 0 3.07.39 4.24.9 1.08.48 1.76 1.56 1.76 2.73V18H6v-1.61c0-1.18.68-2.26 1.76-2.73 1.17-.52 2.61-.91 4.24-.91M4 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m1.13 1.1c-.37-.06-.74-.1-1.13-.1-.99 0-1.93.21-2.78.58C.48 14.9 0 15.62 0 16.43V18h4.5v-1.61c0-.83.23-1.61.63-2.29M20 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m4 3.43c0-.81-.48-1.53-1.22-1.85-.85-.37-1.79-.58-2.78-.58-.39 0-.76.04-1.13.1.4.68.63 1.46.63 2.29V18H24zM12 6c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3"}),"Groups");const _=({onClose:p})=>{const[h,D]=o.useState(""),[w,C]=o.useState(""),[n,u]=o.useState(""),{user:I}=G(r=>r.auth),[g,f]=o.useState(""),[b,q]=o.useState(null),[x,y]=o.useState(null),[M,v]=o.useState(!1),[A,R]=o.useState(null),U=r=>{R(r)},j=r=>{if(!r)return null;const s=new Date,d=new Date(r);let c=s.getFullYear()-d.getFullYear(),t=s.getMonth()-d.getMonth();return(t<0||t===0&&s.getDate()<d.getDate())&&(c--,t=12+t),c===0?t>0?t:0:t>0?c+t/12:c},k=r=>{const s=r.target.files[0];s&&(q(s),y(URL.createObjectURL(s)))},a=async()=>{var d,c;if(!h||!n||!g)return l.error("Name, Username, and Password are required");const r=j(A);v(!0);const s=l.loading("Submitting...");try{const t=new FormData;t.append("name",h),t.append("bio",w),t.append("username",n),t.append("password",g),t.append("age",r),b&&t.append("avatar",b),t.append("createdBy",I._id);const B={withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}},{data:T}=await Y.post(`${O}/api/v1/user/new`,t,B);l.success(T.message,{id:s}),p()}catch(t){l.error(((c=(d=t==null?void 0:t.response)==null?void 0:d.data)==null?void 0:c.message)||"Something went wrong",{id:s})}finally{v(!1)}};return e.jsx(F,{open,onClose:p,children:e.jsxs(i,{p:{xs:"1rem",sm:"3rem"},width:"25rem",spacing:"2rem",sx:{maxHeight:"80vh",overflowY:"auto","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:"#f1f1f1",borderRadius:"10px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#888",borderRadius:"10px"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:"#555"}},children:[e.jsx(L,{textAlign:"center",variant:"h5",children:"Add User"}),e.jsxs(i,{spacing:2,children:[e.jsxs(i,{alignItems:"center",position:"relative",children:[e.jsx(se,{sx:{width:"10rem",height:"10rem",objectFit:"cover",border:"2px solid #ccc"},src:x}),e.jsxs(W,{sx:{position:"sticky",bottom:8,marginTop:-4,width:"3rem",height:"3rem",marginLeft:15,right:8,color:"#fff",bgcolor:"#ccc",":hover":{bgcolor:"#888"}},component:"label",children:[e.jsx(oe,{}),e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:k})]})]}),e.jsx(m,{required:!0,label:"Name",value:h,onChange:r=>D(r.target.value),fullWidth:!0}),e.jsx(m,{required:!0,label:"Username",value:n,onChange:r=>u(r.target.value),fullWidth:!0}),e.jsx(m,{required:!0,label:"Birth Date",type:"date",InputLabelProps:{shrink:!0},value:A,onChange:r=>U(r.target.value),fullWidth:!0}),e.jsx(m,{required:!0,label:"Password",type:"password",value:g,onChange:r=>f(r.target.value),fullWidth:!0}),e.jsx(m,{label:"Bio",value:w,onChange:r=>C(r.target.value),fullWidth:!0,multiline:!0,rows:3})]}),e.jsxs(i,{direction:"row",justifyContent:"space-evenly",children:[e.jsx(S,{color:"error",size:"medium",variant:"contained",onClick:p,children:"Cancel"}),e.jsx(S,{variant:"contained",size:"medium",onClick:a,disabled:M,children:"Submit"})]})]})})};_.propTypes={onClose:E.func.isRequired};const Ce=()=>{var k;const{isNewGroup:p}=G(a=>a.misc),h=localStorage.getItem("userID"),D=V(),[w,{isLoading:C}]=te(J),n=ee(""),[u,I]=o.useState([]),{user:g}=G(a=>a.auth),[f,b]=o.useState(!1),[q]=$(),{data:x,isLoading:y,error:M,refetch:v}=Q(h);ae([{usersLoading:y,usersError:M}]),o.useEffect(()=>{f===!1&&v()},[f,v]);const R=a=>{I(r=>r.includes(a)?r.filter(s=>s!==a):[...r,a])},U=()=>{if(!n.value)return l.error("Group name is required");if(u.length<3)return l.error("Please select at least 3 members");w("Creating group...",{name:n.value,members:u}).then(()=>{const a=u.map(r=>q({parentUserId:g._id,groupName:n.value,receiverId:r}));Promise.all(a).then(()=>{l.success("Group and requests created successfully"),j()}).catch(()=>l.error("Failed to create requests for some users"))}).catch(()=>l.error("Failed to create group"))},j=()=>{D(K(!1))};return e.jsxs(e.Fragment,{children:[e.jsx(F,{onClose:j,open:p,children:e.jsxs(i,{p:{xs:"1rem",sm:"3rem"},width:"25rem",spacing:"2rem",sx:{maxHeight:"80vh",overflowY:"auto","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:"#f1f1f1",borderRadius:"10px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#888",borderRadius:"10px"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:"#555"}},children:[e.jsx(L,{textAlign:"center",variant:"h5",children:"Create Group"}),e.jsx(i,{spacing:1,children:e.jsx(m,{required:!0,label:"Group Name",value:n.value,onChange:n.changeHandler,fullWidth:!0})}),e.jsx(i,{direction:"row",justifyContent:"center",marginBottom:"1rem",children:e.jsxs(X,{variant:"body2",textAlign:"left",sx:{fontSize:"1rem",display:"flex",alignItems:"center"},children:["Add Member",e.jsx(N,{sx:{cursor:"pointer",color:"#3c3c3c",marginLeft:"0.6rem","&:hover":{color:"#898989"}},onClick:()=>b(!0)})]})}),e.jsx(i,{spacing:1,children:y?e.jsx(Z,{variant:"rectangular",height:48}):(k=x==null?void 0:x.users)==null?void 0:k.map(a=>e.jsx(re,{user:a,handler:R,isAdded:u.includes(a._id)},a._id))}),e.jsxs(i,{direction:"row",justifyContent:"space-evenly",children:[e.jsx(S,{color:"error",size:"medium",variant:"contained",onClick:j,children:"Cancel"}),e.jsx(S,{variant:"contained",size:"medium",onClick:U,disabled:C,children:C?"Creating...":"Create"})]})]})}),f&&e.jsx(_,{onClose:()=>b(!1)})]})};export{Ce as default};
